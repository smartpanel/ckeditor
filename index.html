<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GrapesJS CKEditor</title>
    <link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet">
    <script src="https://unpkg.com/grapesjs@0.22.14/dist/grapes.min.js"></script>
    <script src="https://unpkg.com/grapesjs-mjml@1.0.7/dist/index.js"></script>
    <script src="https://cdn.ckeditor.com/4.21.0/standard-all/ckeditor.js"></script>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }
      .cke_toolbar.cke_toolbar {
        min-height: 33px;
      }
    </style>
  </head>
  <body>

    <div id="gjs" style="height:0px; overflow:hidden">
      <mjml><mj-body background-color="#f4f4f4"><mj-section><mj-spacer height="50px">
      </mj-spacer></mj-section><mj-section padding-top="0" padding-bottom="0" padding-left="0" padding-right="0" background-color="#e6e6e6"><mj-column><mj-image src="https://dummyimage.com/600x160/e6e6e6/6a6c6f" padding-top="0" padding-bottom="0" padding-left="0" padding-right="0">
      </mj-image></mj-column></mj-section><mj-section padding-left="0" padding-right="0" background-color="#FFFFFF" padding-top="20px" padding-bottom="20px"><mj-column><mj-text font-size="22px"><p>Hello {full-name}</p>
      </mj-text><mj-text font-size="14px" line-height="1.6em"><p>Lorem Ipsum dolor est</p>
      </mj-text></mj-column></mj-section></mj-body></mjml>
    </div>


    <script>
      setTimeout(() => {
        window.editor = grapesjs.init({
          height: '100%',
          noticeOnUnload: 0,
          storageManager: { autoload: 0 },
          container: '#gjs',
          fromElement: true,

          plugins: ['grapesjs-mjml', 'grapesjs-plugin-ckeditor'],
          pluginsOpts: {
            'grapesjs-plugin-ckeditor': {
              onToolbar: el => {
                el.style.minWidth = '350px';
              },
              options: {
                extraPlugins: 'sharedspace,panelbutton,colorbutton,clipboard,pastefromword,pastetools,justify,richcombo', // emoji
                toolbarGroups: [
                  { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },
                  { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },
                  { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },
                  { name: 'forms', groups: [ 'forms' ] },
                  { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },
                  { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },
                  { name: 'links', groups: [ 'links' ] },
                  { name: 'insert', groups: [ 'insert' ] },
                  '/',
                  { name: 'styles', groups: [ 'styles' ] },
                  { name: 'colors', groups: [ 'colors' ] },
                  { name: 'tools', groups: [ 'tools' ] },
                  { name: 'others', groups: [ 'others' ] },
                  { name: 'about', groups: [ 'about' ] },
                ],
                removeButtons: 'Paste,Source,Save,NewPage,Preview,Print,Templates,Scayt,SelectAll,Find,Replace,Undo,Cut,Copy,Redo,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Subscript,Superscript,CopyFormatting,RemoveFormat,Outdent,Indent,Blockquote,CreateDiv,BidiRtl,BidiLtr,Language,Anchor,Image,Flash,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,Styles,Maximize,ShowBlocks,About',
                enterMode: CKEDITOR.ENTER_P,
                shiftEnterMode: CKEDITOR.ENTER_BR,
                disallowedContent: 'p',
                disableAutoInline: true,
                defaultLanguage: 'en',
                language: 'es',
                versionCheck: false,    
                removeDialogTabs: 'image:advanced',
                pasteFromWordPromptCleanup: true,
                pasteFromWordRemoveStyles: false,
                pasteFromWordRemoveFontStyles: true,    
                forcePasteAsPlainText: true,
                ignoreEmptyParagraph: true,
                removeFormatAttributes: true
              }
            }
          }
        });

        // Do stuff on load
        editor.onReady(function () {
          // Wait for CKEDITOR load
          setTimeout(() => {
            if (CKEDITOR) {
              CKEDITOR.dtd.$editable.a = 1;
            }
          }, 200);
        });
      }, 10)
    </script>
  </body>
</html>
